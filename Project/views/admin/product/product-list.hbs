<h2>Danh sách sản phẩm tồn kho</h2>
<p><strong>Tổng giá trị tồn kho:</strong> <span id="totalValue">{{totalValue}}</span> VND</p>
<p><strong>Tổng số lượng tồn kho:</strong> <span id="totalQty">{{totalQty}}</span></p>

<table border="1" cellpadding="8">
    <thead>
    <tr>
        <th>Tên sản phẩm</th>
        <th>Giá (VND)</th>
        <th>Số lượng tồn kho</th>
        <th>Hành động</th>
    </tr>
    </thead>
    <tbody>
    {{#each products}}
        <tr data-id="{{this._id}}">
            <td>{{this.name}}</td>
            <td>{{this.price}}</td>
            <td>
                <input type="number" class="qty-input" value="{{this.qty}}" min="0">
            </td>
            <td>
                <button class="update-btn">Cập nhật</button>
            </td>
        </tr>
    {{/each}}
    </tbody>
</table>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        $('.update-btn').click(function() {
            const row = $(this).closest('tr');
            const productId = row.data('id');
            const qty = row.find('.qty-input').val();

            $.ajax({
                url: '/admin/product/update-qty-ajax',
                method: 'POST',
                data: { productId, qty },
                success: function(res) {
                    if (res.success) {
                        alert('Cập nhật thành công!');
                        // Cập nhật qty hiển thị (nếu có cột khác) và tổng
                        row.find('.qty-input').val(res.qty);
                        $('#totalQty').text(res.totalQty);
                        $('#totalValue').text(res.totalValue);
                    } else {
                        alert('Lỗi: ' + res.error);
                    }
                },
                error: function() {
                    alert('Lỗi server');
                }
            });
        });
    });
</script>
